1. Find the total number of active categories.
[
  {
    $match: {
      isActive: true
    }
  },
  {
    $count: 'Total Active Category'
  }
]



2. Retrieve the list of users who have made more than 2 orders.
[
  {
    $group: {
      _id: "$user_id",
      "count_order": {
        $sum: 1
      },
      order_id: {$push: "$_id"}
    }
  },
  {
    $match: {
      count_order: {$gte: 2}
    }
  },
  {
    $lookup: {
      from: "users",
      localField: "_id",
      foreignField: "_id",
      as: "users"
    }
  },
  {
    $unwind: {
      path: "$users"
    }
  },
  {
    $project: {
      _id: 1,
      order_id: 1,
      count_order: 1,
      name: "$users.name",
      mobile_no: "$users.mobile_no"
    }
  }
]



3. Calculate the total revenue generated by each seller.
[
  {
    $group: {
      _id: "$seller_id",
      "total_revenue": {
        $sum: "$total_amount"
      }
    }
  },
  {
    $lookup: {
      from: "users",
      localField: "_id",
      foreignField: "_id",
      as: "users"
    }
  },
  {
    $unwind: {
      path: "$users"
    }
  },
  {
    $project: {
      _id: 1,
      name: "$users.name",
      total_revenue: 1,
    }
  }
]



4. Retrieve the products with the highest average rating.
[
  {
    $group: {
      _id: "$product_id",
      "revenue_rating": {
       $avg: "$rating"
      }
    }
  },
  {
    $sort: {
      revenue_rating: -1
    }
  },
  {
    $limit: 2
  },
  {
    $lookup: {
      from: "products",
      localField: "_id",
      foreignField: "_id",
      as: "products"
    }
  },
  {
    $unwind: {
      path: "$products"
    }
  },
  {
    $project: {
      _id: 1,
      name: "$products.name",
      revenue_rating: 1,
    }
  }
]



5. Calculate the total number of products in each subcategory.
[
  {
    $group: {
      _id: "$subcategory_id",
      "total_product": {
        $sum: 1
      }
    }
  },
  {
    $lookup: {
      from: "subcategories",
      localField: "_id",
      foreignField: "_id",
      as: "subcategories"
    }
  },
  {
    $unwind: {
      path: "$subcategories"
    }
  },
  {
    $project: {
      _id: 1,
      total_product: 1,
      name: "$subcategories.subcategory_name"
    }
  }
]



6. Find the users who have not made any orders.



7. Identify the most popular product (highest number of reviews).
[
  {
    $group: {
      _id: "$product_id",
      "total_review": {
        $sum: 1
      }
    }
  },
  {
    $sort: {
      total_review: -1
    }
  },
  {
    $limit: 1
  },
  {
    $lookup: {
      from: "products",
      localField: "_id",
      foreignField: "_id",
      as: "products"
    }
  },
  {
    $unwind: {
      path: "$products"
    }
  },
  {
    $project: {
      _id: 1,
      name: "$products.name",
     total_review: 1
    }
  }
]



8. Calculate the total revenue and average order value for each seller.
[
  {
    $group: {
      _id: "$seller_id",
      total_revenue: {
        $sum: "$total_amount"
      },
      total_orders: {
        $sum: 1
      },
      total_order_amount: {
        $sum: "$total_amount"
      }
    }
  },
  {
    $lookup: {
      from: "users",
      localField: "_id",
      foreignField: "_id",
      as: "users"
    }
  },
  {
    $unwind: {
      path: "$users"
    }
  },
  {
    $project: {
      _id: 1,
      name: "$users.name",
      total_revenue: 1,
      average_order_value: {
        $divide: ["$total_order_amount", "$total_orders"]
      }
    }
  }
]



9. Find the products with a quantity less than 20 in the Variant collection.
[
  {
    $match: {
      "attributes.Quantity": {
        $lt: 20
      }
    }
  },
  {
    $lookup: {
      from: "products",
      localField: "product_id",
      foreignField: "_id",
      as: "products"
    }
  },
  {
    $unwind: {
      path: "$products",
    }
  },
  {
    $project: {
      name: "$products.name"
    }
  }
]




10. Retrieve the top 5 customers with the highest total order value.
[
  {
    $group: {
      _id: "$user_id",
      "count_order": {
        $sum: 1
      }
    }
  },
  {
    $sort: {
      count_order: -1
    }
  },
  {
    $limit: 5
  },
  {
    $lookup: {
      from: "users",
      localField: "_id",
      foreignField: "_id",
      as: "users"
    }
  },
  {
    $unwind: {
      path: "$users",
    }
  },
  {
    $project: {
      _id: 1,
      count_order: 1,
      name: "$users.name"
    }
  }
]
or
[
  {
    $group: {
      _id: "$user_id",
      "total_amount": {
        $sum: "$total_amount"
      }
    }
  },
  {
    $sort: {
      total_amount: -1
    }
  },
  {
    $limit: 5
  },
  {
    $lookup: {
      from: "users",
      localField: "_id",
      foreignField: "_id",
      as: "users"
    }
  },
  {
    $unwind: {
      path: "$users",
    }
  },
  {
    $project: {
      _id: 1,
      total_amount: 1,
      name: "$users.name"
    }
  }
]



11. Find the average rating for each product.
12. Retrieve the latest 5 reviews with user details.
13. Identify the users who have items in their cart with a quantity greater than 5.
14. Calculate the total number of orders placed using each payment gateway.
15. Find the subcategories with no active products.
16. Retrieve the orders with a total amount greater than 2000 and status as "Completed."
17. Identify the products that have not been reviewed.
18. Calculate the total revenue and total quantity sold for each product.
19. Find the top 3 subcategories with the highest average product price.
20. Retrieve the products that have received reviews with ratings greater than 4.
21. Retrieve product data with their variant details from category.
22. Retrieve Categories with Subcategory, Products with product count.
23. Retrieve Payments with Order and Product Details.